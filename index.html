<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instruksi Kerja Pemasangan Perangkat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .school-input {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .school-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .school-input input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .instruction-section {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 4px solid #3498db;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .section-number {
            background-color: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .requirements {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .requirements li {
            margin-bottom: 8px;
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-top: 15px;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background-color: #e8f4fc;
        }
        
        .upload-icon {
            font-size: 40px;
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .upload-text {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .upload-hint {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .map-preview {
            height: 200px;
            background-color: #eee;
            border-radius: 8px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
        }
        
        .hidden {
            display: none;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }
        
        .btn-submit {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-submit:hover {
            background-color: #27ae60;
        }
        
        .btn-reset {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-reset:hover {
            background-color: #c0392b;
        }
        
        .btn-download {
            background-color: #9b59b6;
            color: white;
        }
        
        .btn-download:hover {
            background-color: #8e44ad;
        }
        
        .btn-capture {
            background-color: #3498db;
            color: white;
            margin-top: 10px;
        }
        
        .btn-capture:hover {
            background-color: #2980b9;
        }
        
        .status-message {
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .folder-info {
            background-color: #e8f4fc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #3498db;
        }
        
        .download-section {
            background-color: #e8f6f3;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            border-left: 4px solid #2ecc71;
        }
        
        .download-info {
            margin-bottom: 15px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: #2ecc71;
            width: 0%;
            transition: width 0.3s;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .instruction-section {
                padding: 15px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Instruksi Kerja Pemasangan Perangkat</h1>
            <p class="subtitle">Ikuti langkah-langkah di bawah ini dengan teliti dan lengkapi semua persyaratan</p>
        </header>
        
        <form id="installationForm">
            <!-- Input Nama Sekolah -->
            <div class="school-input">
                <label for="schoolName">Nama Sekolah:</label>
                <input type="text" id="schoolName" placeholder="Masukkan nama sekolah lengkap" required>
            </div>
            
            <!-- Langkah 1 -->
            <div class="instruction-section">
                <div class="section-title">
                    <div class="section-number">1</div>
                    <h2>Foto Plang Sekolah</h2>
                </div>
                <p>Ambil foto plang sekolah yang jelas dan dapat terbaca dengan baik.</p>
                <div class="requirements">
                    <p><strong>Persyaratan:</strong></p>
                    <ul>
                        <li>Foto harus jelas dan terbaca</li>
                        <li>Harus ada Geo Tagging / Gmaps</li>
                    </ul>
                </div>
                
                <div class="upload-area" onclick="triggerUpload('photo1')">
                    <div class="upload-icon">ðŸ“·</div>
                    <div class="upload-text">Klik untuk Mengunggah Foto</div>
                    <div class="upload-hint">Format: JPG, PNG | Maks: 5MB</div>
                </div>
                <input type="file" id="photo1" class="hidden" accept="image/*" onchange="previewImage(this, 'preview1')">
                <img id="preview1" class="preview-image hidden">
                
                <button type="button" class="btn-capture" onclick="captureLocation('location1')">Ambil Lokasi Saat Ini</button>
                <div id="location1" class="map-preview">Lokasi belum diambil</div>
            </div>
            
            <!-- Langkah 2 -->
            <div class="instruction-section">
                <div class="section-title">
                    <div class="section-number">2</div>
                    <h2>Foto PIC dengan Dus</h2>
                </div>
                <p>Ambil foto PIC (Person In Charge) bersama dengan dus perangkat.</p>
                <div class="requirements">
                    <p><strong>Persyaratan:</strong></p>
                    <ul>
                        <li>Wajib menunjukkan wajah PIC dengan jelas</li>
                        <li>Dus perangkat harus terlihat utuh</li>
                        <li>Harus ada Geo Tagging / Gmaps</li>
                    </ul>
                </div>
                
                <div class="upload-area" onclick="triggerUpload('photo2')">
                    <div class="upload-icon">ðŸ“·</div>
                    <div class="upload-text">Klik untuk Mengunggah Foto</div>
                    <div class="upload-hint">Format: JPG, PNG | Maks: 5MB</div>
                </div>
                <input type="file" id="photo2" class="hidden" accept="image/*" onchange="previewImage(this, 'preview2')">
                <img id="preview2" class="preview-image hidden">
                
                <button type="button" class="btn-capture" onclick="captureLocation('location2')">Ambil Lokasi Saat Ini</button>
                <div id="location2" class="map-preview">Lokasi belum diambil</div>
            </div>
            
            <!-- Langkah 3 -->
            <div class="instruction-section">
                <div class="section-title">
                    <div class="section-number">3</div>
                    <h2>Foto Kelengkapan Perangkat</h2>
                </div>
                <p>Ambil foto semua kelengkapan perangkat yang akan dipasang.</p>
                <div class="requirements">
                    <p><strong>Persyaratan:</strong></p>
                    <ul>
                        <li>Foto 3 kabel</li>
                        <li>1 Remote</li>
                        <li>Baterai</li>
                        <li>2 Pen</li>
                        <li>1 Buku panduan</li>
                        <li>1 Buku garansi</li>
                        <li>Harus ada Geo Tagging / Gmaps</li>
                    </ul>
                </div>
                
                <div class="upload-area" onclick="triggerUpload('photo3')">
                    <div class="upload-icon">ðŸ“·</div>
                    <div class="upload-text">Klik untuk Mengunggah Foto</div>
                    <div class="upload-hint">Format: JPG, PNG | Maks: 5MB</div>
                </div>
                <input type="file" id="photo3" class="hidden" accept="image/*" onchange="previewImage(this, 'preview3')">
                <img id="preview3" class="preview-image hidden">
                
                <button type="button" class="btn-capture" onclick="captureLocation('location3')">Ambil Lokasi Saat Ini</button>
                <div id="location3" class="map-preview">Lokasi belum diambil</div>
            </div>
            
            <!-- Langkah 4 -->
            <div class="instruction-section">
                <div class="section-title">
                    <div class="section-number">4</div>
                    <h2>Foto Proses Instalasi/Pemasangan</h2>
                </div>
                <p>Dokumentasikan proses instalasi atau pemasangan perangkat.</p>
                <div class="requirements">
                    <p><strong>Persyaratan:</strong></p>
                    <ul>
                        <li>Foto harus menunjukkan proses pemasangan</li>
                        <li>Perangkat harus terlihat sedang dipasang</li>
                        <li>Harus ada Geo Tagging / Gmaps</li>
                    </ul>
                </div>
                
                <div class="upload-area" onclick="triggerUpload('photo4')">
                    <div class="upload-icon">ðŸ“·</div>
                    <div class="upload-text">Klik untuk Mengunggah Foto</div>
                    <div class="upload-hint">Format: JPG, PNG | Maks: 5MB</div>
                </div>
                <input type="file" id="photo4" class="hidden" accept="image/*" onchange="previewImage(this, 'preview4')">
                <img id="preview4" class="preview-image hidden">
                
                <button type="button" class="btn-capture" onclick="captureLocation('location4')">Ambil Lokasi Saat Ini</button>
                <div id="location4" class="map-preview">Lokasi belum diambil</div>
            </div>
            
            <!-- Langkah 5 -->
            <div class="instruction-section">
                <div class="section-title">
                    <div class="section-number">5</div>
                    <h2>Foto IMEI / SN (Serial Number)</h2>
                </div>
                <p>Ambil foto IMEI atau Serial Number yang terletak di belakang TV.</p>
                <div class="requirements">
                    <p><strong>Persyaratan:</strong></p>
                    <ul>
                        <li>IMEI/SN harus terbaca dengan jelas</li>
                        <li>Foto diambil dari belakang TV</li>
                        <li>Harus ada Geo Tagging / Gmaps</li>
                    </ul>
                </div>
                
                <div class="upload-area" onclick="triggerUpload('photo5')">
                    <div class="upload-icon">ðŸ“·</div>
                    <div class="upload-text">Klik untuk Mengunggah Foto</div>
                    <div class="upload-hint">Format: JPG, PNG | Maks: 5MB</div>
                </div>
                <input type="file" id="photo5" class="hidden" accept="image/*" onchange="previewImage(this, 'preview5')">
                <img id="preview5" class="preview-image hidden">
                
                <button type="button" class="btn-capture" onclick="captureLocation('location5')">Ambil Lokasi Saat Ini</button>
                <div id="location5" class="map-preview">Lokasi belum diambil</div>
            </div>
            
            <!-- Langkah 6 -->
            <div class="instruction-section">
                <div class="section-title">
                    <div class="section-number">6</div>
                    <h2>Foto Training</h2>
                </div>
                <p>Ambil foto sesi training yang sedang berlangsung.</p>
                <div class="requirements">
                    <p><strong>Persyaratan:</strong></p>
                    <ul>
                        <li>Wajib menunjukkan Teach Buddy</li>
                        <li>Teach Buddy harus terinstal di semua direktorat</li>
                        <li>Harus ada Geo Tagging / Gmaps</li>
                    </ul>
                </div>
                
                <div class="upload-area" onclick="triggerUpload('photo6')">
                    <div class="upload-icon">ðŸ“·</div>
                    <div class="upload-text">Klik untuk Mengunggah Foto</div>
                    <div class="upload-hint">Format: JPG, PNG | Maks: 5MB</div>
                </div>
                <input type="file" id="photo6" class="hidden" accept="image/*" onchange="previewImage(this, 'preview6')">
                <img id="preview6" class="preview-image hidden">
                
                <button type="button" class="btn-capture" onclick="captureLocation('location6')">Ambil Lokasi Saat Ini</button>
                <div id="location6" class="map-preview">Lokasi belum diambil</div>
            </div>
            
            <!-- Langkah 7 -->
            <div class="instruction-section">
                <div class="section-title">
                    <div class="section-number">7</div>
                    <h2>Foto BAPP Halaman 1</h2>
                </div>
                <p>Ambil foto Berita Acara Pemeriksaan dan Penerimaan (BAPP) halaman 1.</p>
                <div class="requirements">
                    <p><strong>Persyaratan:</strong></p>
                    <ul>
                        <li>IMEI barcode ditempel</li>
                        <li>Di conteng yang sesuai</li>
                        <li>Bagian atas diisi semua</li>
                        <li>Nama PIC/Kepala sekolah harus sama</li>
                        <li>Wajib ada stempel dan tanda tangan</li>
                        <li>Tidak menggunakan geo tagging / gmaps</li>
                    </ul>
                </div>
                
                <div class="upload-area" onclick="triggerUpload('photo7')">
                    <div class="upload-icon">ðŸ“·</div>
                    <div class="upload-text">Klik untuk Mengunggah Foto</div>
                    <div class="upload-hint">Format: JPG, PNG | Maks: 5MB</div>
                </div>
                <input type="file" id="photo7" class="hidden" accept="image/*" onchange="previewImage(this, 'preview7')">
                <img id="preview7" class="preview-image hidden">
            </div>
            
            <!-- Langkah 8 -->
            <div class="instruction-section">
                <div class="section-title">
                    <div class="section-number">8</div>
                    <h2>Foto BAPP Halaman 2</h2>
                </div>
                <p>Ambil foto Berita Acara Pemeriksaan dan Penerimaan (BAPP) halaman 2.</p>
                <div class="requirements">
                    <p><strong>Persyaratan:</strong></p>
                    <ul>
                        <li>Di conteng</li>
                        <li>Nama pelatihan diisi</li>
                        <li>Media pelatihan diconteng di luar jaringan</li>
                        <li>Coret "belum dapat diterima" dan "belum berada"</li>
                        <li>Nama PIC/Kepala sekolah harus sama dengan halaman 1</li>
                        <li>Wajib ada stempel dan tanda tangan</li>
                        <li>Tidak menggunakan geo tagging / gmaps</li>
                    </ul>
                </div>
                
                <div class="upload-area" onclick="triggerUpload('photo8')">
                    <div class="upload-icon">ðŸ“·</div>
                    <div class="upload-text">Klik untuk Mengunggah Foto</div>
                    <div class="upload-hint">Format: JPG, PNG | Maks: 5MB</div>
                </div>
                <input type="file" id="photo8" class="hidden" accept="image/*" onchange="previewImage(this, 'preview8')">
                <img id="preview8" class="preview-image hidden">
            </div>
            
            <div class="action-buttons">
                <button type="button" class="btn-reset" onclick="resetForm()">Reset Semua</button>
                <button type="button" class="btn-submit" onclick="submitForm()">Kirim Semua Data</button>
                <button type="button" class="btn-download" onclick="downloadZip()" id="downloadBtn" disabled>Download ZIP</button>
            </div>
            
            <div id="statusMessage" class="status-message hidden"></div>
            <div id="folderInfo" class="folder-info hidden"></div>
            
            <div id="downloadSection" class="download-section hidden">
                <h3>Download Berhasil!</h3>
                <div class="download-info">
                    <p>File ZIP berisi semua foto dan data telah berhasil dibuat.</p>
                    <p>File: <strong id="zipFileName"></strong></p>
                </div>
                <div class="progress-bar">
                    <div class="progress" id="zipProgress"></div>
                </div>
                <p>File akan otomatis terdownload. Jika tidak, klik tombol di bawah:</p>
                <button type="button" class="btn-download" onclick="retryDownload()">Download Ulang ZIP</button>
            </div>
        </form>
        
        <footer>
            <p>Â© 2023 - Instruksi Kerja Pemasangan Perangkat</p>
        </footer>
    </div>

    <script>
        // Data untuk menyimpan informasi yang diperlukan
        let formData = {
            schoolName: '',
            locations: {},
            photos: {},
            folderName: ''
        };

        // Fungsi untuk memicu upload file
        function triggerUpload(inputId) {
            document.getElementById(inputId).click();
        }
        
        // Fungsi untuk menampilkan preview gambar
        function previewImage(input, previewId) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById(previewId);
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    
                    // Simpan data foto
                    const stepNumber = input.id.replace('photo', '');
                    formData.photos[stepNumber] = {
                        file: file,
                        dataUrl: e.target.result
                    };
                }
                reader.readAsDataURL(file);
            }
        }
        
        // Fungsi untuk mengambil lokasi
        function captureLocation(locationId) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // Tampilkan lokasi di elemen
                        const locationElement = document.getElementById(locationId);
                        locationElement.innerHTML = `
                            <div style="padding: 10px; text-align: center;">
                                <div style="font-weight: bold; margin-bottom: 5px;">Lokasi berhasil diambil</div>
                                <div style="font-size: 14px;">Lat: ${lat.toFixed(6)}</div>
                                <div style="font-size: 14px;">Lng: ${lng.toFixed(6)}</div>
                                <div style="margin-top: 10px;">
                                    <a href="https://maps.google.com/?q=${lat},${lng}" target="_blank" style="color: #3498db; text-decoration: none;">
                                        Lihat di Google Maps
                                    </a>
                                </div>
                            </div>
                        `;
                        
                        // Simpan data lokasi
                        const stepNumber = locationId.replace('location', '');
                        formData.locations[stepNumber] = {
                            lat: lat,
                            lng: lng,
                            timestamp: new Date().toISOString()
                        };
                    },
                    function(error) {
                        alert('Gagal mengambil lokasi: ' + error.message);
                    }
                );
            } else {
                alert('Browser tidak mendukung geolocation');
            }
        }
        
        // Fungsi untuk reset form
        function resetForm() {
            if (confirm('Apakah Anda yakin ingin mereset semua data?')) {
                document.getElementById('installationForm').reset();
                
                // Sembunyikan semua preview gambar
                const previews = document.querySelectorAll('.preview-image');
                previews.forEach(preview => {
                    preview.classList.add('hidden');
                });
                
                // Reset lokasi
                const locations = document.querySelectorAll('.map-preview');
                locations.forEach(location => {
                    location.innerHTML = 'Lokasi belum diambil';
                });
                
                // Sembunyikan pesan status
                document.getElementById('statusMessage').classList.add('hidden');
                document.getElementById('folderInfo').classList.add('hidden');
                document.getElementById('downloadSection').classList.add('hidden');
                
                // Nonaktifkan tombol download
                document.getElementById('downloadBtn').disabled = true;
                
                // Reset data
                formData = {
                    schoolName: '',
                    locations: {},
                    photos: {},
                    folderName: ''
                };
            }
        }
        
        // Fungsi untuk membuat nama folder
        function createFolderName(schoolName) {
            const cleanName = schoolName.replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_');
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-');
            return `Instalasi_${cleanName}_${timestamp}`;
        }
        
        // Fungsi untuk submit form
        function submitForm() {
            // Validasi nama sekolah
            const schoolName = document.getElementById('schoolName').value.trim();
            if (!schoolName) {
                alert('Harap masukkan nama sekolah!');
                document.getElementById('schoolName').focus();
                return;
            }
            
            formData.schoolName = schoolName;
            
            // Validasi sederhana
            let isValid = true;
            const requiredPhotos = ['photo1', 'photo2', 'photo3', 'photo4', 'photo5', 'photo6', 'photo7', 'photo8'];
            
            for (const photoId of requiredPhotos) {
                const photoInput = document.getElementById(photoId);
                if (!photoInput.files || photoInput.files.length === 0) {
                    isValid = false;
                    break;
                }
            }
            
            // Validasi lokasi untuk langkah 1-6
            const requiredLocations = ['location1', 'location2', 'location3', 'location4', 'location5', 'location6'];
            for (const locationId of requiredLocations) {
                const locationElement = document.getElementById(locationId);
                if (locationElement.innerHTML === 'Lokasi belum diambil') {
                    isValid = false;
                    break;
                }
            }
            
            // Tampilkan pesan status
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.classList.remove('hidden');
            
            if (isValid) {
                // Membuat folder sekolah
                formData.folderName = createFolderName(schoolName);
                
                // Tampilkan informasi folder
                const folderInfo = document.getElementById('folderInfo');
                folderInfo.innerHTML = `
                    <h3>Data Siap Didownload</h3>
                    <p><strong>Nama Folder:</strong> ${formData.folderName}</p>
                    <p>Semua data telah divalidasi dan siap untuk didownload dalam format ZIP.</p>
                    <p>Klik tombol "Download ZIP" untuk mengunduh semua foto dan data.</p>
                `;
                folderInfo.classList.remove('hidden');
                
                // Aktifkan tombol download
                document.getElementById('downloadBtn').disabled = false;
                
                statusMessage.textContent = 'Semua data telah divalidasi dan siap didownload!';
                statusMessage.className = 'status-message success';
                
            } else {
                statusMessage.textContent = 'Harap lengkapi semua data yang diperlukan!';
                statusMessage.className = 'status-message error';
                document.getElementById('folderInfo').classList.add('hidden');
                document.getElementById('downloadBtn').disabled = true;
            }
            
            // Scroll ke pesan status
            statusMessage.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Fungsi untuk membuat dan mendownload ZIP
        async function downloadZip() {
            if (!formData.folderName) {
                alert('Harap kirim data terlebih dahulu sebelum download!');
                return;
            }
            
            const zip = new JSZip();
            const folder = zip.folder(formData.folderName);
            
            // Buat subfolder untuk setiap langkah
            const stepFolders = {
                '1': '01_Plang_Sekolah',
                '2': '02_PIC_dengan_Dus',
                '3': '03_Kelengkapan_Perangkat',
                '4': '04_Proses_Instalasi',
                '5': '05_IMEI_SN',
                '6': '06_Training',
                '7': '07_BAPP_Halaman_1',
                '8': '08_BAPP_Halaman_2'
            };
            
            // Progress bar
            const progressBar = document.getElementById('zipProgress');
            let processedFiles = 0;
            const totalFiles = Object.keys(formData.photos).length + Object.keys(formData.locations).length;
            
            // Tambahkan foto ke ZIP
            for (const step in formData.photos) {
                const stepFolder = folder.folder(stepFolders[step]);
                const photoData = formData.photos[step];
                
                // Konversi data URL ke blob
                const response = await fetch(photoData.dataUrl);
                const blob = await response.blob();
                
                stepFolder.file(`foto_${step}.jpg`, blob);
                
                // Update progress
                processedFiles++;
                progressBar.style.width = `${(processedFiles / totalFiles) * 100}%`;
            }
            
            // Tambahkan data lokasi
            const locationData = {
                sekolah: formData.schoolName,
                timestamp: new Date().toISOString(),
                lokasi: formData.locations
            };
            
            folder.file('data_lokasi.json', JSON.stringify(locationData, null, 2));
            
            processedFiles++;
            progressBar.style.width = `${(processedFiles / totalFiles) * 100}%`;
            
            // Tambahkan file README
            const readmeContent = `
INSTALASI PERANGKAT SEKOLAH
===========================

Nama Sekolah: ${formData.schoolName}
Tanggal Instalasi: ${new Date().toLocaleDateString('id-ID')}

STRUKTUR FOLDER:
- 01_Plang_Sekolah: Foto plang sekolah dengan geo tagging
- 02_PIC_dengan_Dus: Foto PIC bersama dus perangkat dengan geo tagging
- 03_Kelengkapan_Perangkat: Foto kelengkapan perangkat dengan geo tagging
- 04_Proses_Instalasi: Foto proses pemasangan dengan geo tagging
- 05_IMEI_SN: Foto IMEI/Serial Number dengan geo tagging
- 06_Training: Foto sesi training dengan geo tagging
- 07_BAPP_Halaman_1: Foto BAPP halaman 1
- 08_BAPP_Halaman_2: Foto BAPP halaman 2

File data_lokasi.json berisi koordinat GPS dari setiap langkah pekerjaan.
            `;
            
            folder.file('README.txt', readmeContent);
            
            // Generate ZIP
            const zipFileName = `${formData.folderName}.zip`;
            
            zip.generateAsync({ type: 'blob' })
            .then(function(content) {
                // Simpan file ZIP
                saveAs(content, zipFileName);
                
                // Tampilkan section download
                document.getElementById('downloadSection').classList.remove('hidden');
                document.getElementById('zipFileName').textContent = zipFileName;
                
                // Scroll ke section download
                document.getElementById('downloadSection').scrollIntoView({ behavior: 'smooth' });
            })
            .catch(function(error) {
                alert('Terjadi kesalahan saat membuat file ZIP: ' + error.message);
            });
        }
        
        // Fungsi untuk download ulang
        function retryDownload() {
            downloadZip();
        }
    </script>
</body>
</html>
